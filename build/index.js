(()=>{"use strict";const e=window.wp.hooks,t=window.wp.element,o=window.wp.blockEditor,s=window.wp.components,r=window.wp.i18n,l=window.wp.compose,n=window.wp.data,i=window.ReactJSXRuntime;(0,e.addFilter)("blocks.registerBlockType","query-loop-exclude-posts/add-exclude-current-attribute",((e,t)=>("core/query"!==t||(e.attributes={...e.attributes,excludeCurrent:{type:"boolean",default:!1}}),e)));const c=(0,l.createHigherOrderComponent)((e=>l=>{if("core/query"!==l.name)return(0,i.jsx)(e,{...l});const{setAttributes:n,attributes:c}=l,{query:u={},excludeCurrent:p=!1}=c,a=u.exclude||[],x=u.postType||"post",w=(0,t.useCallback)((e=>{n({query:{...u,exclude:e}})}),[n,u]);return(0,t.useEffect)((()=>{const e=wp.data.select("core/editor").getCurrentPostId();console.log(e),p&&e&&Number.isInteger(e)?a.includes(e)||w([...a,e]):e&&Number.isInteger(e)&&a.includes(e)&&w(a.filter((t=>t!==e)))}),[p,a,w]),(0,i.jsxs)(t.Fragment,{children:[(0,i.jsx)(e,{...l}),(0,i.jsx)(o.InspectorControls,{children:(0,i.jsxs)(s.PanelBody,{title:(0,r.sprintf)(/* Translators: %s is the post type name */ /* Translators: %s is the post type name */
(0,r.__)("Exclude %ss","query-loop-exclude-posts"),x.charAt(0).toUpperCase()+x.slice(1)),initialOpen:!0,children:[(0,i.jsx)(s.PanelRow,{children:(0,i.jsx)(d,{excludePosts:a,postType:x,onChange:w})}),(0,i.jsxs)(s.PanelRow,{children:[(0,i.jsx)("div",{children:(0,i.jsx)("label",{children:(0,r.sprintf)((0,r.__)("Exclude current %s","query-loop-exclude-posts"),x)})}),(0,i.jsx)(s.FormToggle,{label:(0,r.sprintf)((0,r.__)("Exclude current %s","query-loop-exclude-posts"),x),checked:p,onChange:()=>{n({excludeCurrent:!p})}})]})]})})]})}),"withExcludePostsControl");(0,e.addFilter)("editor.BlockEdit","query-loop-exclude-posts/with-exclude-posts-control",c);const d=(0,n.withSelect)(((e,t)=>{const{postType:o}=t,{getEntityRecords:s}=e("core");return{posts:s("postType",o,{per_page:-1})}}))((({posts:e,excludePosts:o,onChange:l})=>{const n=(0,t.useMemo)((()=>e?e.map((e=>({id:e.id,title:e.title.rendered}))):[]),[e]),c=(0,t.useMemo)((()=>n.filter((e=>o.includes(e.id))).map((e=>e.title))),[n,o]);return(0,i.jsx)(s.FormTokenField,{label:(0,r.__)("Exclude by Title","query-loop-exclude-posts"),value:c,suggestions:n.map((e=>e.title)),onChange:e=>{const t=n.filter((t=>e.includes(t.title))).map((e=>e.id));l(t)},__nextHasNoMarginBottom:!0,__experimentalShowHowTo:!1})}))})();